<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeWise AI - Stock Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/premium_features.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tier_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/institutional_ui_optimization.css') }}">

    <style>
        /* Enhanced Brand Animation Styles */
        .animated-brand {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 25%, #8b5cf6 50%, #ec4899 75%, #60a5fa 100%);
            background-size: 300% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 6s ease-in-out infinite;
            font-weight: 900;
            font-size: 2.2rem;
            letter-spacing: -1px;
            text-shadow: 0 0 40px rgba(96, 165, 250, 0.3);
            position: relative;
            line-height: 1;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            text-align: left;
            align-self: flex-start;
            display: block;
            width: 100%;
        }

        @keyframes shimmer {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        .brand-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            animation: brandFadeIn 1.2s ease-out;
            flex-grow: 1;
            padding: 0.5rem 0;
        }

        @keyframes brandFadeIn {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-tagline {
            font-size: 0.85rem;
            background: linear-gradient(135deg, #60a5fa, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            letter-spacing: 0.3px;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 0.5rem;
            opacity: 0;
            animation: taglineFadeIn 1s ease-out 0.4s forwards;
        }

        /* Crown Upgrade Button */
        .crown-upgrade-button {
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
            border: none;
            border-radius: 16px;
            padding: 0.75rem;
            color: white !important;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.4), 0 0 0 1px rgba(251, 191, 36, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            position: relative;
            overflow: hidden;
        }
        
        .crown-upgrade-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .crown-upgrade-button:hover {
            background: linear-gradient(135deg, #f59e0b, #d97706, #92400e);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 24px rgba(251, 191, 36, 0.5), 0 0 0 1px rgba(251, 191, 36, 0.2);
        }
        
        .crown-upgrade-button:hover::before {
            left: 100%;
        }

        .crown-upgrade-button:active {
            transform: translateY(-1px) scale(1.02);
        }

        .crown-upgrade-button i {
            font-size: 1.3rem !important;
            color: white !important;
            animation: crownPulse 4s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));
            display: block !important;
        }

        @keyframes crownPulse {
            0%, 100% { 
                transform: scale(1);
                filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));
            }
            50% { 
                transform: scale(1.1);
                filter: drop-shadow(0 0 12px rgba(255,255,255,0.5));
            }
        }

        @keyframes taglineFadeIn {
            0% {
                opacity: 0;
                transform: translateY(5px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced header styling */
        .header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.2rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        /* Subtle glow effect on hover */
        .brand-container:hover .animated-brand {
            animation: shimmerHover 3s ease-in-out infinite;
            text-shadow: 0 0 50px rgba(96, 165, 250, 0.6);
            transform: scale(1.02);
        }

        @keyframes shimmerHover {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .animated-brand {
                font-size: 1.8rem;
                letter-spacing: -0.8px;
            }
            .hero-tagline {
                font-size: 0.75rem;
            }
            .crown-upgrade-button {
                width: 46px;
                height: 46px;
                padding: 0.65rem;
            }
            .crown-upgrade-button i {
                font-size: 1.1rem;
            }
            .header {
                padding: 1rem 1.2rem;
            }
        }
        
        /* Enhanced search interface */
        .main-content {
            padding-top: 1rem;
            max-width: 100vw;
            overflow-x: hidden;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }
        
        .search-container {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        /* Search Hero Section */
        .search-hero {
            margin-bottom: 1.5rem;
            padding: 1rem;
        }
        
        .search-hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            line-height: 1.1;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 25%, #8b5cf6 50%, #ec4899 75%, #f59e0b 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: heroShimmer 8s ease-in-out infinite;
        }
        
        @keyframes heroShimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .search-hero-subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto 2rem;
            line-height: 1.5;
        }
        
        /* Enhanced Search Input */
        .search-input-container.enhanced {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 1.25rem 1.5rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(30px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }
        
        .search-input-container.enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(96, 165, 250, 0.1), transparent);
            transition: left 0.8s;
        }
        
        .search-input-container.enhanced:focus-within {
            border-color: rgba(96, 165, 250, 0.6);
            box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.1), 0 12px 40px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 0.12);
        }
        
        .search-input-container.enhanced:focus-within::before {
            left: 100%;
        }
        
        .search-input.enhanced {
            font-size: 1.1rem;
            font-weight: 500;
            color: white;
            background: transparent;
            border: none;
            outline: none;
            width: 100%;
            padding: 0.5rem 80px 0.5rem 0;
        }
        
        .search-input.enhanced::placeholder {
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
        }
        
        .ai-indicator.enhanced {
            background: linear-gradient(135deg, #60a5fa, #8b5cf6);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(96, 165, 250, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .ai-pulse {
            position: absolute;
            top: 50%;
            left: 0.5rem;
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            transform: translateY(-50%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: translateY(-50%) scale(1); }
            50% { opacity: 0.7; transform: translateY(-50%) scale(1.2); }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/tier_integration.js') }}"></script>
    <script src="{{ url_for('static', filename='js/institutional_dropdown_system.js') }}"></script>
    <script src="{{ url_for('static', filename='js/institutional_tier_fix.js') }}"></script>
    <script src="{{ url_for('static', filename='js/institutional_premium_features.js') }}"></script>
    <script src="{{ url_for('static', filename='js/advanced_institutional_tools.js') }}"></script>
    <script src="{{ url_for('static', filename='js/interface_stabilizer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bloomberg_killer_intelligence.js') }}"></script>
    <script>
        // Initialize tier integration on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof TierIntegrationManager !== 'undefined') {
                window.tierManager = new TierIntegrationManager();
            }
        });
    </script>
</head>
<body>
    <!-- ChatGPT-Style Interface -->
    <div class="chatgpt-container" style="max-width: 100vw; overflow-x: hidden; margin: 0; padding: 0; box-sizing: border-box; width: 100%;">
        <!-- Header -->
        <div class="header institutional-header" style="max-width: 100vw; width: 100%; box-sizing: border-box; margin: 0; padding: 1.2rem 1.5rem;">
            <div class="header-left">
                <div class="brand-container">
                    <span class="brand-name animated-brand">TradeWise AI</span>
                </div>
            </div>
            <!-- Professional Navigation -->
            <div class="institutional-nav">
                <!-- Static test dropdown to verify visibility -->
                <div class="institutional-dropdown">
                    <button class="institutional-dropdown-toggle" style="background: rgba(30, 64, 175, 0.15); border: 1px solid rgba(124, 58, 237, 0.3); color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                        📊 Market Intelligence ▼
                    </button>
                </div>
                <div class="institutional-dropdown">
                    <button class="institutional-dropdown-toggle" style="background: rgba(30, 64, 175, 0.15); border: 1px solid rgba(124, 58, 237, 0.3); color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                        📡 Live Data ▼
                    </button>
                </div>
                <div class="institutional-dropdown">
                    <button class="institutional-dropdown-toggle" style="background: rgba(30, 64, 175, 0.15); border: 1px solid rgba(124, 58, 237, 0.3); color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                        📋 Portfolio Tools ▼
                    </button>
                </div>
                <div class="institutional-dropdown">
                    <button class="institutional-dropdown-toggle" style="background: rgba(30, 64, 175, 0.15); border: 1px solid rgba(124, 58, 237, 0.3); color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                        🤖 AI Signals ▼
                    </button>
                </div>
            </div>
            <div class="header-right">
                <div class="subscription-status-header" id="subscription-status">
                    Free Features: Basic
                </div>
                <button class="crown-upgrade-button" id="upgrade-button" onclick="window.location.href='/subscription'" title="Upgrade to Premium">
👑
                </button>
                <div class="tools-dropdown">
                    <button class="tools-toggle-compact" onclick="toggleToolsDropdown()">
🛠️
                        <span class="tools-text">Tools</span>
                        <span class="tools-chevron">⌄</span>
                    </button>
                    <div class="tools-dropdown-menu" id="tools-dropdown-menu">
                        <!-- Market Intelligence -->
                        <div class="dropdown-item market-intelligence-toggle" onclick="toggleMarketIntelligence()">
🧠
                            <span>Market Intelligence</span>
                            <div class="live-indicator" style="margin-left: auto; display: flex; align-items: center;">
                                <span style="font-size: 10px; font-weight: 500;">LIVE</span>
                            </div>
                        </div>
                        
                        <!-- Market Intelligence Content (Initially Hidden) -->
                        <div id="market-intelligence-content" style="display: none; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; margin: 10px 0; max-width: 350px; max-height: 400px; overflow-y: auto; overscroll-behavior: contain;">
                            {% include 'market_intelligence_widget.html' %}
                        </div>
                        
                        <div class="dropdown-item" onclick="togglePortfolio()">
💰
                            <span>Portfolio</span>
                        </div>
                        <div class="dropdown-item" onclick="openInstitutionalContact()">
🏛️
                            <span>Institutional Contact</span>
                        </div>
                        <div class="dropdown-item" onclick="openSettings()">
⚙️
                            <span>Account Settings</span>
                        </div>
                        <div class="dropdown-item" onclick="openSubscriptionPlans()">
⭐
                            <span>Subscription Plans</span>
                        </div>
                        <div class="dropdown-item" onclick="showTradingHistory()">
🕒
                            <span>Trading History</span>
                        </div>
                        <div class="dropdown-item" onclick="showWatchlist()">
👁️
                            <span>Watchlist</span>
                        </div>
                        <hr style="margin: 10px 0; border-color: rgba(255,255,255,0.1);">
                        <div class="dropdown-item" onclick="window.location.href='/logout'">
🚪
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notification Area -->
        <div id="notification-area"></div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Enhanced Portfolio Section -->
            <div id="portfolio-section" class="portfolio-section" style="display: none;">
                <div class="portfolio-header">
                    <h3>📊 Your Portfolio</h3>
                    <button class="close-portfolio" onclick="togglePortfolio()">
×
                    </button>
                </div>
                
                <!-- Enhanced Portfolio Overview Cards -->
                <div class="enhanced-portfolio-overview" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                    <div class="enhanced-portfolio-card" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 15px; backdrop-filter: blur(10px); position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #3b82f6, #8b5cf6);"></div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <div style="width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
💲
                            </div>
                            <div>
                                <div style="font-size: 0.75rem;">Total Value</div>
                                <div style="font-size: 1.2rem; font-weight: 700;" id="enhanced-total-value">$0.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="enhanced-portfolio-card" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 15px; backdrop-filter: blur(10px); position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #8b5cf6, #7c3aed);"></div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <div style="width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
🪙
                            </div>
                            <div>
                                <div style="font-size: 0.75rem;">Total Invested</div>
                                <div style="font-size: 1.2rem; font-weight: 700;" id="enhanced-total-invested">$0.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="enhanced-portfolio-card" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 15px; backdrop-filter: blur(10px); position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #10b981, #059669);"></div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <div style="width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #10b981, #059669);">
📈
                            </div>
                            <div>
                                <div style="font-size: 0.75rem;">Total Return</div>
                                <div style="font-size: 1.2rem; font-weight: 700;" id="enhanced-total-return">$0.00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Holdings Section -->
                <div class="enhanced-holdings-section" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 15px; backdrop-filter: blur(10px); margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                        <h4 style="font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; gap: 8px; margin: 0;">
💼
                            Your Holdings
                        </h4>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); border: none; color: white; padding: 6px 12px; border-radius: 8px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 0.8rem;" onclick="showDepositModal()">
+
                                Add Funds
                            </button>
                            <button style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; color: white; padding: 6px 12px; border-radius: 8px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 0.8rem;" onclick="showBuyModal()">
🛒
                                Buy Stock
                            </button>
                        </div>
                    </div>

                    <div id="enhanced-holdings-container">
                        <!-- Loading state -->
                        <div style="text-align: center; padding: 20px;" id="enhanced-portfolio-loading">
                            <div style="width: 24px; height: 24px; border: 2px solid rgba(255, 255, 255, 0.1); border-top: 2px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
                            <p style="font-size: 0.9rem;">Loading your portfolio...</p>
                        </div>

                        <!-- Empty state -->
                        <div style="text-align: center; padding: 30px 15px; display: none;" id="enhanced-portfolio-empty">
                            <div style="font-size: 2.5rem; margin-bottom: 12px;">📊</div>
                            <h5 style="margin-bottom: 8px;">Start Building Your Portfolio</h5>
                            <p style="margin-bottom: 15px; font-size: 0.9rem;">Search for stocks above to begin building your personalized portfolio with AI guidance.</p>
                            <button style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); border: none; color: white; padding: 6px 12px; border-radius: 8px; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; font-size: 0.8rem;" onclick="togglePortfolio()">
                                Search Stocks
                            </button>
                        </div>

                        <!-- Holdings will be populated here -->
                        <div id="enhanced-holdings-grid" style="display: grid; gap: 10px; display: none;">
                            <!-- Holdings items will be dynamically inserted -->
                        </div>
                    </div>
                </div>
                
                <!-- Enhanced AI Portfolio Builder Section -->
                <div class="enhanced-ai-builder-section" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; backdrop-filter: blur(10px); margin-bottom: 20px; position: relative; overflow: hidden;">
                    <!-- Gradient accent -->
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #60a5fa, #8b5cf6, #10b981);"></div>
                    
                    <!-- Header section -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #60a5fa, #8b5cf6); margin-bottom: 12px;">
                            <div style="color: white; font-size: 1.5rem;">🤖</div>
                        </div>
                        <h4 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 8px;">
                            AI Portfolio Builder
                        </h4>
                        <p style="font-size: 0.9rem; margin: 0; max-width: 300px; margin-left: auto; margin-right: auto;">
                            Let our AI create a personalized portfolio based on your goals and risk tolerance
                        </p>
                    </div>
                    
                    <!-- Action buttons grid -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <button style="background: linear-gradient(135deg, #60a5fa, #3b82f6); border: none; color: white; padding: 12px 16px; border-radius: 10px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem; transition: transform 0.2s ease, box-shadow 0.2s ease;" 
                                onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(96, 165, 250, 0.3)'"
                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                                onclick="startPortfolioQuestionnaire()">
🪄
                            Build Portfolio
                        </button>
                        <button style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 12px 16px; border-radius: 10px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem; transition: all 0.2s ease;" 
                                onmouseover="this.style.background='rgba(255, 255, 255, 0.15)'; this.style.transform='translateY(-1px)'"
                                onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'"
                                onclick="showPortfolioStrategies()">
📋
                            View Strategies
                        </button>
                    </div>
                    
                    <!-- Quick stats -->
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; font-size: 0.8rem;">
                            <div style="text-align: center;">
                                <div>AI Accuracy</div>
                                <div style="font-weight: 600;">87.3%</div>
                            </div>
                            <div style="text-align: center;">
                                <div>Strategies</div>
                                <div style="font-weight: 600;">5 Types</div>
                            </div>
                            <div style="text-align: center;">
                                <div>Risk Levels</div>
                                <div style="font-weight: 600;">All Covered</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Copilot Condensed Indicator (for premium users) -->
            <div id="ai-copilot-condensed" class="ai-copilot-condensed" style="display: none;">
                <div class="copilot-indicator" onclick="toggleCopilotExpanded()">
                    <div class="indicator-left">

                        <span class="copilot-status">AI Copilot</span>
                        <span class="copilot-badge">ACTIVE</span>
                        <span class="signal-count" id="signal-count-indicator">2 signals</span>
                    </div>
                    <div class="indicator-right">
                        <span class="expand-icon" id="copilot-expand-icon">⌄</span>
                    </div>
                </div>
                
                <!-- Expanded Copilot Content (hidden by default) -->
                <div id="copilot-expanded-content" class="copilot-expanded-content" style="display: none;">
                    <div id="copilot-signals" class="copilot-signals">
                        <div class="text-center text-muted p-3">
⏳
                            <p class="mb-0" style="font-size: 0.9rem;">AI scanning markets...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Institutional Market Terminal Section (First for Institutional Users) -->
            <div id="bloomberg-terminal-section" class="bloomberg-terminal-section" style="display: none; margin-bottom: 1.5rem;">
                <div style="background: linear-gradient(135deg, #1e40af, #7c3aed); border-radius: 12px; padding: 20px; color: white; position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);">
                    <!-- Animated background -->
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><defs><pattern id=\"grid\" width=\"10\" height=\"10\" patternUnits=\"userSpaceOnUse\"><path d=\"M 10 0 L 0 0 0 10\" fill=\"none\" stroke=\"rgba(255,255,255,0.05)\" stroke-width=\"1\"/></pattern></defs><rect width=\"100\" height=\"100\" fill=\"url(%23grid)\"/></svg>'); opacity: 0.5;"></div>
                    
                    <!-- Header with live indicator -->
                    <div style="position: relative; z-index: 2;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    📊
                                </div>
                                <div>
                                    <h4 style="margin: 0; font-weight: 700; font-size: 1.2rem;">INSTITUTIONAL MARKET TERMINAL</h4>
                                    <div style="font-size: 0.8rem; opacity: 0.9;">Professional Market Data & Analytics</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 8px; height: 8px; background: #00ff88; border-radius: 50%; animation: pulse 2s infinite;"></div>
                                <span style="background: rgba(255,255,255,0.2); padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">LIVE</span>
                                <span style="background: #10b981; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">98% SAVINGS</span>
                            </div>
                        </div>
                        
                        <!-- Live market data grid -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 15px;">
                            <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px; text-align: center;">
                                <div style="font-size: 0.7rem; opacity: 0.8;">S&P 500</div>
                                <div style="font-size: 1.1rem; font-weight: 700; color: #10b981;">5,847.23</div>
                                <div style="font-size: 0.6rem; color: #10b981;">+0.8%</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px; text-align: center;">
                                <div style="font-size: 0.7rem; opacity: 0.8;">VIX</div>
                                <div style="font-size: 1.1rem; font-weight: 700; color: #ef4444;">18.42</div>
                                <div style="font-size: 0.6rem; color: #ef4444;">+12.3%</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px; text-align: center;">
                                <div style="font-size: 0.7rem; opacity: 0.8;">Dark Pool</div>
                                <div style="font-size: 1.1rem; font-weight: 700; color: #3b82f6;">42.7%</div>
                                <div style="font-size: 0.6rem; color: #3b82f6;">High</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px; text-align: center;">
                                <div style="font-size: 0.7rem; opacity: 0.8;">Options</div>
                                <div style="font-size: 1.1rem; font-weight: 700; color: #8b5cf6;">$2.8B</div>
                                <div style="font-size: 0.6rem; color: #8b5cf6;">Heavy</div>
                            </div>
                        </div>
                        
                        <!-- Professional ticker tape -->
                        <div style="background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; overflow: hidden; white-space: nowrap; position: relative;">
                            <div style="display: inline-block; animation: scroll 30s linear infinite;">
                                <span style="margin-right: 30px; font-family: monospace; font-size: 0.8rem;">AAPL $211.18 ↗ +0.57%</span>
                                <span style="margin-right: 30px; font-family: monospace; font-size: 0.8rem;">TSLA $248.77 ↘ -2.34%</span>
                                <span style="margin-right: 30px; font-family: monospace; font-size: 0.8rem;">NVDA $425.89 ↗ +1.23%</span>
                                <span style="margin-right: 30px; font-family: monospace; font-size: 0.8rem;">MSFT $385.21 ↗ +0.45%</span>
                                <span style="margin-right: 30px; font-family: monospace; font-size: 0.8rem;">GOOGL $142.55 ↘ -0.87%</span>
                                <span style="margin-right: 30px; font-family: monospace; font-size: 0.8rem;">AMZN $155.73 ↗ +1.12%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <style>
                @keyframes scroll {
                    0% { transform: translateX(100%); }
                    100% { transform: translateX(-100%); }
                }
                
                /* Institutional tier optimizations */
                .tier-institutional .institutional-hidden {
                    display: none !important;
                    visibility: hidden !important;
                }
                
                .tier-institutional #popular-stocks-section,
                .tier-institutional #investment-themes-section,
                .tier-institutional #market-insights-section {
                    display: none !important;
                    visibility: hidden !important;
                }
                </style>
            </div>
            
            <!-- Compact Search Header (Hidden for Institutional Users) -->
            <div id="discover-investment-section" class="search-hero-compact" style="margin-bottom: 1rem; padding: 0.5rem 0;">
                <div class="hero-tagline">AI-Powered Trading</div>
                <h3 class="search-title-compact" style="font-size: 1.8rem; margin-bottom: 0.3rem;">
                    <span class="hero-gradient">Discover</span> Your Next Investment
                </h3>
                <p class="search-subtitle-compact" style="margin-bottom: 0.5rem;">AI-powered insights for any stock, crypto, or ETF</p>
            </div>
            
            <!-- Stock Search Content (default view) -->
            <div id="search-content" class="search-content">
                <!-- Popular Stocks Dropdown (Hidden for Institutional Users) -->
                <div id="popular-stocks-section" class="popular-stocks-condensed dropdown-container">
                    <div class="popular-indicator" onclick="togglePopularExpanded()">
                        <div class="popular-left">
⭐
                            <span class="popular-label">Popular Stocks</span>
                            <div class="popular-pills">
                                <span class="popular-pill trending">Trending</span>
                                <span class="popular-pill growth">Growth</span>
                                <span class="popular-pill tech">Tech</span>
                            </div>
                        </div>
                        <div class="popular-right">
                            <span class="expand-icon" id="popular-expand-icon">⌄</span>
                        </div>
                    </div>
                    
                    <!-- Expanded Popular Stocks Content -->
                    <div id="popular-expanded-content" class="popular-expanded-content" style="display: none;">
                        <div class="popular-grid">
                            <button class="popular-stock-card" onclick="searchStock('AAPL')">
                                <div class="stock-symbol">AAPL</div>
                                <div class="stock-name">Apple Inc.</div>
                                <div class="stock-price">$180.25</div>
                            </button>
                            <button class="popular-stock-card" onclick="searchStock('TSLA')">
                                <div class="stock-symbol">TSLA</div>
                                <div class="stock-name">Tesla Inc.</div>
                                <div class="stock-price">$245.67</div>
                            </button>
                            <button class="popular-stock-card" onclick="searchStock('NVDA')">
                                <div class="stock-symbol">NVDA</div>
                                <div class="stock-name">NVIDIA Corp.</div>
                                <div class="stock-price">$425.89</div>
                            </button>
                            <button class="popular-stock-card" onclick="searchStock('MSFT')">
                                <div class="stock-symbol">MSFT</div>
                                <div class="stock-name">Microsoft Corp.</div>
                                <div class="stock-price">$385.21</div>
                            </button>
                            <button class="popular-stock-card" onclick="searchStock('GOOGL')">
                                <div class="stock-symbol">GOOGL</div>
                                <div class="stock-name">Alphabet Inc.</div>
                                <div class="stock-price">$142.55</div>
                            </button>
                            <button class="popular-stock-card" onclick="searchStock('AMZN')">
                                <div class="stock-symbol">AMZN</div>
                                <div class="stock-name">Amazon.com Inc.</div>
                                <div class="stock-price">$155.73</div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Investment Themes Dropdown (Hidden for Institutional Users) -->
                <div id="investment-themes-section" class="investment-themes-condensed dropdown-container">
                    <div class="themes-indicator" onclick="toggleThemesExpanded()">
                        <div class="themes-left">
📊
                            <span class="themes-label">Investment Themes</span>
                            <div class="theme-pills">
                                <span class="theme-pill" onclick="event.stopPropagation(); searchStock('NVDA')">AI</span>
                                <span class="theme-pill" onclick="event.stopPropagation(); searchStock('TSLA')">EV</span>
                                <span class="theme-pill" onclick="event.stopPropagation(); searchStock('AAPL')">Blue Chip</span>
                                <span class="theme-pill" onclick="event.stopPropagation(); searchTheme('ESG')">ESG</span>
                                <span class="theme-pill-more">+9 more</span>
                            </div>
                        </div>
                        <div class="themes-right">
                            <span class="expand-icon" id="themes-expand-icon">⌄</span>
                        </div>
                    </div>
                    
                    <!-- Expanded Themes Content (hidden by default) -->
                    <div id="themes-expanded-content" class="themes-expanded-content" style="display: none;">
                        <div class="suggestion-cards">
                            <div class="suggestion-card ai-theme" onclick="searchTheme('AI')">
                                <div class="card-icon">🤖</div>
                                <div class="card-content">
                                    <div class="card-title">Artificial Intelligence</div>
                                    <div class="card-subtitle">Next-gen tech revolutionizing industries</div>
                                    <div class="card-performance">+127% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card ev-theme" onclick="searchTheme('EV')">
                                <div class="card-icon">⚡</div>
                                <div class="card-content">
                                    <div class="card-title">Electric Vehicles</div>
                                    <div class="card-subtitle">Sustainable transportation leaders</div>
                                    <div class="card-performance">+89% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card crypto-theme" onclick="searchTheme('Crypto')">
                                <div class="card-icon">🪙</div>
                                <div class="card-content">
                                    <div class="card-title">Cryptocurrency</div>
                                    <div class="card-subtitle">Digital asset ecosystem</div>
                                    <div class="card-performance">+156% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card biotech-theme" onclick="searchTheme('Biotech')">
                                <div class="card-icon">🧬</div>
                                <div class="card-content">
                                    <div class="card-title">Biotechnology</div>
                                    <div class="card-subtitle">Healthcare innovation pipeline</div>
                                    <div class="card-performance">+67% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card fintech-theme" onclick="searchTheme('Fintech')">
                                <div class="card-icon">💳</div>
                                <div class="card-content">
                                    <div class="card-title">Financial Technology</div>
                                    <div class="card-subtitle">Digital banking revolution</div>
                                    <div class="card-performance">+45% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card cloud-theme" onclick="searchTheme('Cloud')">
                                <div class="card-icon">☁️</div>
                                <div class="card-content">
                                    <div class="card-title">Cloud Computing</div>
                                    <div class="card-subtitle">Enterprise digital transformation</div>
                                    <div class="card-performance">+78% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card space-theme" onclick="searchTheme('Space')">
                                <div class="card-icon">🚀</div>
                                <div class="card-content">
                                    <div class="card-title">Space Technology</div>
                                    <div class="card-subtitle">Commercial space exploration</div>
                                    <div class="card-performance">+112% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card energy-theme" onclick="searchTheme('CleanEnergy')">
                                <div class="card-icon">☀️</div>
                                <div class="card-content">
                                    <div class="card-title">Clean Energy</div>
                                    <div class="card-subtitle">Renewable power infrastructure</div>
                                    <div class="card-performance">+92% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card gaming-theme" onclick="searchTheme('Gaming')">
                                <div class="card-icon">🎮</div>
                                <div class="card-content">
                                    <div class="card-title">Gaming & Esports</div>
                                    <div class="card-subtitle">Interactive entertainment growth</div>
                                    <div class="card-performance">+34% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card esg-theme" onclick="searchTheme('ESG')">
                                <div class="card-icon">🍃</div>
                                <div class="card-content">
                                    <div class="card-title">ESG Investing</div>
                                    <div class="card-subtitle">Sustainable & responsible companies</div>
                                    <div class="card-performance">+56% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card defensive-theme" onclick="searchTheme('Defensive')">
                                <div class="card-icon">🛡️</div>
                                <div class="card-content">
                                    <div class="card-title">Defensive Stocks</div>
                                    <div class="card-subtitle">Stable dividend-paying companies</div>
                                    <div class="card-performance">+23% YTD</div>
                                </div>
                            </div>
                            <div class="suggestion-card emerging-theme" onclick="searchTheme('Emerging')">
                                <div class="card-icon">🌍</div>
                                <div class="card-content">
                                    <div class="card-title">Emerging Markets</div>
                                    <div class="card-subtitle">High-growth developing economies</div>
                                    <div class="card-performance">+43% YTD</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Market Insights Dropdown (Hidden for Institutional Users) -->
                <div id="market-insights-section" class="market-insights-condensed dropdown-container">
                    <div class="insights-indicator" onclick="toggleInsightsExpanded()">
                        <div class="insights-left">
📈
                            <span class="insights-label">Market Insights</span>
                            <div class="insight-pills">
                                <span class="insight-pill live">Live</span>
                                <span class="insight-pill trend">Trending</span>
                                <span class="insight-pill risk">Risk Alert</span>
                            </div>
                        </div>
                        <div class="insights-right">
                            <span class="expand-icon" id="insights-expand-icon">⌄</span>
                        </div>
                    </div>
                    
                    <!-- Expanded Insights Content -->
                    <div id="insights-expanded-content" class="insights-expanded-content" style="display: none;">
                        <div class="insight-cards">
                            <div class="insight-card market-card">
                                <div class="insight-header">
📊
                                    <span>Market Overview</span>
                                    <span class="live-indicator">LIVE</span>
                                </div>
                                <div class="insight-content">
                                    <div class="market-stats">
                                        <div class="stat">
                                            <span class="stat-label">S&P 500</span>
                                            <span class="stat-value positive">+0.8%</span>
                                        </div>
                                        <div class="stat">
                                            <span class="stat-label">NASDAQ</span>
                                            <span class="stat-value positive">+1.2%</span>
                                        </div>
                                        <div class="stat">
                                            <span class="stat-label">VIX</span>
                                            <span class="stat-value neutral">16.4</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="insight-card trending-card">
                                <div class="insight-header">
🔥
                                    <span>Trending Now</span>
                                    <span class="trend-indicator">HOT</span>
                                </div>
                                <div class="insight-content">
                                    <div class="trending-list">
                                        <div class="trending-item" onclick="searchStock('NVDA')">
                                            <span class="symbol">NVDA</span>
                                            <span class="trend-change">+8.7%</span>
                                        </div>
                                        <div class="trending-item" onclick="searchStock('TSLA')">
                                            <span class="symbol">TSLA</span>
                                            <span class="trend-change">+5.2%</span>
                                        </div>
                                        <div class="trending-item" onclick="searchStock('AAPL')">
                                            <span class="symbol">AAPL</span>
                                            <span class="trend-change">+2.1%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="insight-card ai-card">
                                <div class="insight-header">
🧠
                                    <span>AI Predictions</span>
                                    <span class="confidence-indicator">89% confident</span>
                                </div>
                                <div class="insight-content">
                                    <div class="prediction-text">
                                        Tech sector showing strong momentum. AI-driven stocks expected to outperform through Q4.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="insight-card risk-card">
                                <div class="insight-header">
⚠️
                                    <span>Risk Alerts</span>
                                    <span class="risk-indicator">2 active</span>
                                </div>
                                <div class="insight-content">
                                    <div class="risk-list">
                                        <div class="risk-item moderate">
                                            <span class="risk-text">Bond yields rising - monitor duration risk</span>
                                        </div>
                                        <div class="risk-item low">
                                            <span class="risk-text">Crypto volatility elevated this week</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Search Suggestions -->
                <div id="search-suggestions" class="search-suggestions">
                    <!-- Dynamic suggestions will appear here -->
                </div>
                
                <!-- Search Results Area -->
                <div id="search-results" class="search-results">
                    <!-- Results will appear here -->
                </div>
            </div>
        </div>
        
        <!-- Watchlist Modal -->
        <div id="watchlistModal" class="watchlist-modal">
            <div class="watchlist-modal-content">
                <div class="watchlist-modal-header">
                    <h3>Smart Watchlist</h3>
                    <button class="watchlist-close-btn" onclick="closeWatchlistModal()">
                        ×
                    </button>
                </div>
                <div class="watchlist-modal-body">
                    <div id="watchlistContainer">
                        <!-- Watchlists will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Input Area -->
        <div class="input-area">
            <div class="input-container">
                <input type="text" 
                       id="stock-search-input"
                       placeholder="Ask anything about stocks... (try 'google', 'apple', or 'NVDA')"
                       class="search-input"
                       onkeypress="handleEnterPress(event)"
                       oninput="showSearchSuggestions(this.value)"
                       style="background-image: none !important; -webkit-appearance: none; -moz-appearance: none; appearance: none;">
                <button class="submit-btn" onclick="performSearch()">
                    
                </button>
            </div>
        </div>
    </div>

    <!-- Purchase Modal -->
    <div id="purchaseModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Buy Stock</h2>
                <span class="close" onclick="closePurchaseModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="stock-info">
                    <h3 id="modalSymbol">AAPL</h3>
                    <p id="modalName">Apple Inc.</p>
                    <p>Price: <span id="modalPrice">$150.00</span></p>
                </div>
                <div class="purchase-form">
                    <label for="shareQuantity">Shares:</label>
                    <input type="number" id="shareQuantity" value="1" min="1" onchange="updatePurchaseTotal()">
                    <p>Total: <span id="totalCost">$150.00</span></p>
                    <button id="purchaseButton" onclick="executePurchase()">Buy Now</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/ai_stock_search.js"></script>
    <script src="/static/js/institutional_dropdown_system.js"></script>
    <script src="/static/js/tier_integration.js"></script>
    <script>
        // Simple purchase functions
        function closePurchaseModal() {
            document.getElementById('purchaseModal').style.display = 'none';
        }
        
        function updatePurchaseTotal() {
            const quantity = parseInt(document.getElementById('shareQuantity').value) || 1;
            const price = parseFloat(document.getElementById('modalPrice').textContent.replace('$', '')) || 0;
            const total = quantity * price;
            document.getElementById('totalCost').textContent = '$' + total.toFixed(2);
        }
        
        function executePurchase() {
            alert('Purchase functionality would be implemented here');
        }
    </script>
</body>
</html>
        border-bottom: 1px solid rgba(255,255,255,0.1);
        position: sticky;
        top: 0;
