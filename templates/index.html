{% extends "base.html" %}

{% block content %}
<!-- Main Content Sections -->
<div id="dashboard-section" style="display: block;">
    <!-- Welcome Banner -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="welcome-banner compact">
                <div class="welcome-content">
                    <h2 class="welcome-title">Welcome to Your Trading Command Center</h2>
                    <p class="welcome-subtitle">AI-powered insights at your fingertips</p>
                </div>
                <div class="welcome-stats">
                    <div class="welcome-stat">
                        <span class="stat-icon"><i class="fas fa-brain"></i></span>
                        <span class="stat-value" id="ai-accuracy">98%</span>
                        <span class="stat-label">AI Accuracy</span>
                    </div>
                    <div class="welcome-stat">
                        <span class="stat-icon"><i class="fas fa-chart-trending-up"></i></span>
                        <span class="stat-value" id="market-trend">Bullish</span>
                        <span class="stat-label">Market Trend</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Balance and Market Overview Row -->
    <div class="row mb-3">
        <div class="col-md-4">
            <div class="card bg-dark account-balance-card compact">
                <div class="card-body">
                    <h6 class="mb-2"><i class="fas fa-wallet me-2"></i>Account Balance</h6>
                    <div class="balance-display compact">
                        <span class="balance-amount" id="account-balance">$0.00</span>
                        <div class="balance-actions mt-2">
                            <button class="btn btn-sm btn-success" onclick="showDepositModal()">
                                <i class="fas fa-plus"></i> Deposit
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="showTransactionHistory()">
                                <i class="fas fa-history"></i> History
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card bg-secondary market-overview-card compact">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0"><i class="fas fa-globe me-2"></i>Live Market Pulse</h6>
                        <small class="text-muted" id="last-updated">Loading...</small>
                    </div>
                    <div class="row text-center">
                        <div class="col">
                            <div class="stat-card compact">
                                <div class="stat-number text-primary" id="total-stocks">-</div>
                                <div class="stat-label">Stocks</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="stat-card compact">
                                <div class="stat-number text-success" id="gainers">-</div>
                                <div class="stat-label">Gainers</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="stat-card compact">
                                <div class="stat-number text-danger" id="losers">-</div>
                                <div class="stat-label">Losers</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="stat-card compact">
                                <div class="stat-number" id="avg-change">-</div>
                                <div class="stat-label">Avg Change</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="stat-card compact">
                                <div class="stat-number text-info" id="total-volume">-</div>
                                <div class="stat-label">Volume</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <!-- Performance Summary -->
        <div class="col-lg-4 mb-4">
            <div class="card bg-dark performance-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-trophy me-2"></i>Your Performance</h5>
                </div>
                <div class="card-body">
                    <div class="performance-stats">
                        <div class="stat-row">
                            <span>Total Trades:</span>
                            <span class="text-primary" id="total-trades">0</span>
                        </div>
                        <div class="stat-row">
                            <span>Win Rate:</span>
                            <span class="text-success" id="win-rate">0%</span>
                        </div>
                        <div class="stat-row">
                            <span>Total P&L:</span>
                            <span id="total-pnl">$0.00</span>
                        </div>
                        <div class="stat-row">
                            <span>Realized P&L:</span>
                            <span id="realized-pnl">$0.00</span>
                        </div>
                        <div class="stat-row">
                            <span>Unrealized P&L:</span>
                            <span id="unrealized-pnl">$0.00</span>
                        </div>
                        <div class="stat-row">
                            <span>Avg Confidence:</span>
                            <span class="text-info" id="avg-confidence">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Top Movers -->
        <div class="col-lg-8 mb-4">
            <div class="card bg-dark top-movers-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-trending-up me-2"></i>Top Movers</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-success">Top Gainers</h6>
                            <div id="top-gainers">
                                <div class="text-center text-muted">Loading...</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-danger">Top Losers</h6>
                            <div id="top-losers">
                                <div class="text-center text-muted">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Trades and Alerts -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card bg-dark recent-trades-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Trades</h5>
                </div>
                <div class="card-body">
                    <div id="recent-trades">
                        <div class="text-center text-muted">No recent trades</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="card bg-dark active-alerts-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bell me-2"></i>Active Alerts</h5>
                </div>
                <div class="card-body">
                    <div id="active-alerts">
                        <div class="text-center text-muted">No active alerts</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Stocks Section -->
<div id="stocks-section" style="display: none;">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark stock-filters-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Stock Filters</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label for="sector-filter" class="form-label">Sector</label>
                            <select class="form-select" id="sector-filter">
                                <option value="">All Sectors</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="min-price" class="form-label">Min Price</label>
                            <input type="number" class="form-control" id="min-price" placeholder="0.00" step="0.01">
                        </div>
                        <div class="col-md-3">
                            <label for="max-price" class="form-label">Max Price</label>
                            <input type="number" class="form-control" id="max-price" placeholder="1000.00" step="0.01">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <button class="btn btn-primary d-block w-100" onclick="applyFilters()">
                                <i class="fas fa-search me-1"></i>Apply Filters
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12">
            <div class="card bg-dark stock-scanner-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-area me-2"></i>Stock Ticker Scanner</h5>
                </div>
                <div class="card-body">
                    <div id="stocks-list">
                        <div class="text-center text-muted">Loading stocks...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Alerts Section -->
<div id="alerts-section" style="display: none;">
    <div class="row">
        <div class="col-12">
            <div class="card bg-dark trading-alerts-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bell me-2"></i>Trading Alerts</h5>
                </div>
                <div class="card-body">
                    <div id="alerts-list">
                        <div class="text-center text-muted">Loading alerts...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Portfolio Section -->
<div id="portfolio-section" style="display: none;">
    <div class="row">
        <div class="col-12">
            <div class="card bg-dark portfolio-holdings-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-briefcase me-2"></i>Portfolio Holdings</h5>
                </div>
                <div class="card-body">
                    <div id="portfolio-summary" class="mb-4">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="stat-card">
                                    <div class="stat-number text-primary" id="portfolio-value">$0.00</div>
                                    <div class="stat-label">Total Value</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card">
                                    <div class="stat-number text-info" id="portfolio-cost">$0.00</div>
                                    <div class="stat-label">Total Cost</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card">
                                    <div class="stat-number" id="portfolio-pnl">$0.00</div>
                                    <div class="stat-label">P&L</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card">
                                    <div class="stat-number" id="portfolio-pnl-pct">0%</div>
                                    <div class="stat-label">P&L %</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="portfolio-holdings">
                        <div class="text-center text-muted">No holdings found</div>
                    </div>
                    <div class="mt-4">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Stock prices are updated in real-time. P&L calculations are based on your purchase price.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Trade Modal -->
<div class="modal fade" id="tradeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title">Execute Trade</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="trade-form">
                    <div class="mb-3">
                        <label for="trade-symbol" class="form-label">Symbol</label>
                        <input type="text" class="form-control" id="trade-symbol" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="trade-action" class="form-label">Action</label>
                        <select class="form-select" id="trade-action">
                            <option value="buy">Buy</option>
                            <option value="sell">Sell</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="trade-quantity" class="form-label">Quantity</label>
                        <input type="number" class="form-control" id="trade-quantity" min="1" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Current Price</label>
                        <div class="form-control-plaintext" id="trade-current-price">-</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">AI Confidence</label>
                        <div class="form-control-plaintext" id="trade-confidence">-</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="executeTrade()">Execute Trade</button>
            </div>
        </div>
    </div>
</div>

<!-- Deposit Modal -->
<div class="modal fade" id="depositModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title">Deposit Funds</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="deposit-form">
                    <div class="mb-3">
                        <label for="deposit-amount" class="form-label">Deposit Amount</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="deposit-amount" min="1" step="0.01" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted">
                            <i class="fas fa-lock me-1"></i>
                            Payments are processed securely through Stripe
                        </small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" onclick="processDeposit()" id="deposit-btn">
                    <i class="fas fa-credit-card me-2"></i>Proceed to Payment
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Buy Stock Modal -->
<div class="modal fade" id="buyModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title">Buy Stocks</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="buy-form">
                    <div class="mb-3">
                        <label for="buy-symbol-search" class="form-label">Search Stock Symbol</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="buy-symbol-search" 
                                   placeholder="Enter stock symbol (e.g., AAPL, MSFT, TSLA)" 
                                   style="text-transform: uppercase;">
                            <button type="button" class="btn btn-primary" onclick="searchStock()">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                        <div class="form-text">Enter any valid stock ticker symbol to search</div>
                    </div>
                    
                    <!-- Stock info display after search -->
                    <div id="stock-search-result" style="display: none;">
                        <div class="alert alert-info mb-3">
                            <h6 class="mb-2" id="stock-info-name">-</h6>
                            <div class="row">
                                <div class="col-6">
                                    <small>Sector:</small> <span id="stock-info-sector">-</span>
                                </div>
                                <div class="col-6">
                                    <small>Market Cap:</small> <span id="stock-info-marketcap">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI Risk Analysis -->
                        <div class="mb-3" id="ai-risk-analysis" style="display: none;">
                            <h6 class="mb-2">AI Risk Analysis</h6>
                            <div class="alert alert-dark">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Risk Level:</span>
                                    <span class="badge" id="risk-level-badge">-</span>
                                </div>
                                <div class="mb-2">
                                    <strong>Key Risks:</strong>
                                    <ul class="mb-0 small" id="key-risks-list"></ul>
                                </div>
                                <div>
                                    <strong>Potential Rewards:</strong>
                                    <ul class="mb-0 small" id="potential-rewards-list"></ul>
                                </div>
                                <div class="mt-2 text-center">
                                    <span class="badge" id="ai-recommendation-badge">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="buy-quantity" class="form-label">Number of Shares to Buy</label>
                        <input type="number" class="form-control" id="buy-quantity" min="1" required>
                        <div class="form-text">Enter the number of shares you want to purchase</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Price per Share</label>
                        <div class="form-control-plaintext" id="buy-current-price">-</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Total Purchase Cost</label>
                        <div class="form-control-plaintext fw-bold text-warning" id="buy-total-cost">$0.00</div>
                        <div class="form-text" id="buy-purchase-summary" style="display: none;">
                            You are buying <span id="buy-shares-count">0</span> shares for <span id="buy-total-amount">$0.00</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Your Available Balance</label>
                        <div class="form-control-plaintext text-success" id="buy-available-balance">$0.00</div>
                        <div class="form-text text-danger" id="buy-insufficient-funds" style="display: none;">
                            Insufficient funds! Please deposit more money or reduce quantity.
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="executeBuy()" id="buy-btn">
                    <i class="fas fa-shopping-cart me-2"></i>Buy Stock
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Sell Stock Modal -->
<div class="modal fade" id="sellModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title">Sell Stocks</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="sell-form">
                    <div class="mb-3">
                        <label for="sell-symbol" class="form-label">Stock Symbol</label>
                        <select class="form-select" id="sell-symbol" required>
                            <option value="">Select a stock...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="sell-quantity" class="form-label">Quantity</label>
                        <input type="number" class="form-control" id="sell-quantity" min="1" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Current Price</label>
                        <div class="form-control-plaintext" id="sell-current-price">-</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Total Proceeds</label>
                        <div class="form-control-plaintext" id="sell-total-proceeds">$0.00</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Shares Owned</label>
                        <div class="form-control-plaintext text-info" id="sell-shares-owned">0</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" onclick="executeSell()" id="sell-btn">
                    <i class="fas fa-money-bill-wave me-2"></i>Sell Stock
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Transaction History Modal -->
<div class="modal fade" id="transactionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title">Transaction History</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="transaction-history">
                    <div class="text-center text-muted">Loading transactions...</div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<!-- Custom JS for dashboard -->
<script src="{{ url_for('static', filename='js/notifications.js') }}?v={{ range(1000, 9999) | random }}"></script>
<script src="{{ url_for('static', filename='js/analytics.js') }}?v={{ range(1000, 9999) | random }}"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}?v={{ range(1000, 9999) | random }}"></script>
<script src="{{ url_for('static', filename='js/ai_assistant.js') }}?v={{ range(1000, 9999) | random }}"></script>
{% endblock %}
